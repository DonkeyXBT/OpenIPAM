<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Database - IPAM & CMDB</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="logo">
                <h1>IP Database</h1>
                <span class="subtitle">IPAM & CMDB</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" data-page="dashboard">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item" data-page="subnets">
                    <span class="nav-icon">üåê</span>
                    <span>Subnet Management</span>
                </li>
                <li class="nav-item" data-page="hosts">
                    <span class="nav-icon">üñ•Ô∏è</span>
                    <span>Host Management</span>
                </li>
                <li class="nav-item" data-page="ipam">
                    <span class="nav-icon">üî¢</span>
                    <span>IP Addresses</span>
                </li>
                <li class="nav-item" data-page="import">
                    <span class="nav-icon">üìÅ</span>
                    <span>Import / Export</span>
                </li>
            </ul>
            <div class="sidebar-footer">
                <button id="clearDataBtn" class="btn-danger-small">Clear All Data</button>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="page-header">
                    <h2>Dashboard</h2>
                    <p class="page-description">Overview of your network infrastructure</p>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">üåê</div>
                        <div class="stat-info">
                            <span class="stat-value" id="totalSubnets">0</span>
                            <span class="stat-label">Subnets</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">üñ•Ô∏è</div>
                        <div class="stat-info">
                            <span class="stat-value" id="totalHosts">0</span>
                            <span class="stat-label">Total Hosts</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon yellow">‚ñ∂Ô∏è</div>
                        <div class="stat-info">
                            <span class="stat-value" id="runningHosts">0</span>
                            <span class="stat-label">Running</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon red">‚èπÔ∏è</div>
                        <div class="stat-info">
                            <span class="stat-value" id="stoppedHosts">0</span>
                            <span class="stat-label">Stopped</span>
                        </div>
                    </div>
                </div>
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>IP Utilization</h3>
                        </div>
                        <div class="card-body">
                            <div id="ipUtilization">
                                <div class="utilization-bar-container">
                                    <div class="utilization-info">
                                        <span>Overall Usage</span>
                                        <span id="overallUsagePercent">0%</span>
                                    </div>
                                    <div class="utilization-bar">
                                        <div class="utilization-fill" id="overallUsageBar" style="width: 0%"></div>
                                    </div>
                                    <div class="utilization-details">
                                        <span><span id="assignedIPs">0</span> assigned</span>
                                        <span><span id="availableIPs">0</span> available</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Subnet Overview</h3>
                        </div>
                        <div class="card-body">
                            <div id="subnetOverview" class="subnet-list">
                                <p class="empty-message">No subnets configured</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3>Recent Hosts</h3>
                    </div>
                    <div class="card-body">
                        <table class="data-table" id="recentHostsTable">
                            <thead>
                                <tr>
                                    <th>VM Name</th>
                                    <th>OS</th>
                                    <th>State</th>
                                    <th>IP Addresses</th>
                                    <th>Node</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="5" class="empty-message">No hosts found</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Subnets Page -->
            <div id="subnets" class="page">
                <div class="page-header">
                    <h2>Subnet Management</h2>
                    <button class="btn-primary" onclick="showAddSubnetModal()">+ Add Subnet</button>
                </div>
                <div class="card">
                    <div class="card-body">
                        <table class="data-table" id="subnetsTable">
                            <thead>
                                <tr>
                                    <th>Network</th>
                                    <th>Name</th>
                                    <th>VLAN</th>
                                    <th>Gateway</th>
                                    <th>Total IPs</th>
                                    <th>Assigned</th>
                                    <th>Available</th>
                                    <th>Usage</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="9" class="empty-message">No subnets configured</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Hosts Page -->
            <div id="hosts" class="page">
                <div class="page-header">
                    <h2>Host Management (CMDB)</h2>
                    <button class="btn-primary" onclick="showAddHostModal()">+ Add Host</button>
                </div>
                <div class="filters-bar">
                    <input type="text" id="hostSearchInput" placeholder="Search hosts..." onkeyup="filterHosts()">
                    <select id="hostStateFilter" onchange="filterHosts()">
                        <option value="">All States</option>
                        <option value="running">Running</option>
                        <option value="stopped">Stopped</option>
                    </select>
                    <select id="hostSubnetFilter" onchange="filterHosts()">
                        <option value="">All Subnets</option>
                    </select>
                </div>
                <div class="card">
                    <div class="card-body table-responsive">
                        <table class="data-table" id="hostsTable">
                            <thead>
                                <tr>
                                    <th class="sortable" data-sort="vm_name">VM Name ‚Üï</th>
                                    <th class="sortable" data-sort="operating_system">OS ‚Üï</th>
                                    <th class="sortable" data-sort="state">State ‚Üï</th>
                                    <th class="sortable" data-sort="node">Node ‚Üï</th>
                                    <th>CPU</th>
                                    <th>Memory</th>
                                    <th>Disk</th>
                                    <th>IP Addresses</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="9" class="empty-message">No hosts found</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- IPAM Page -->
            <div id="ipam" class="page">
                <div class="page-header">
                    <h2>IP Address Management</h2>
                    <button class="btn-primary" onclick="showAssignIPModal()">+ Assign IP</button>
                </div>
                <div class="filters-bar">
                    <select id="ipSubnetFilter" onchange="filterIPs()">
                        <option value="">All Subnets</option>
                    </select>
                    <select id="ipStatusFilter" onchange="filterIPs()">
                        <option value="">All Status</option>
                        <option value="assigned">Assigned</option>
                        <option value="available">Available</option>
                        <option value="reserved">Reserved</option>
                    </select>
                    <input type="text" id="ipSearchInput" placeholder="Search IP or hostname..." onkeyup="filterIPs()">
                </div>
                <div class="card">
                    <div class="card-body">
                        <table class="data-table" id="ipsTable">
                            <thead>
                                <tr>
                                    <th class="sortable" data-sort="ip">IP Address ‚Üï</th>
                                    <th>Subnet</th>
                                    <th>Status</th>
                                    <th>Assigned To</th>
                                    <th>OS</th>
                                    <th>State</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="7" class="empty-message">No IP addresses tracked</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Import/Export Page -->
            <div id="import" class="page">
                <div class="page-header">
                    <h2>Import / Export</h2>
                </div>
                <div class="import-export-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>Import from CSV</h3>
                        </div>
                        <div class="card-body">
                            <p>Import hosts from a CSV file. Expected columns:</p>
                            <code class="csv-format">Operating System, Memory Used (GB), Memory Available (GB), VM Name, Node, Disk Size (GB), State, CPU Count, Disk Used (GB), Memory Total (GB), IP Addresses, Fav</code>
                            <div class="file-upload-area" id="dropZone">
                                <input type="file" id="csvFileInput" accept=".csv" onchange="handleFileSelect(event)">
                                <p>üìÅ Drag & drop CSV file here or click to browse</p>
                            </div>
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" id="updateExisting" checked>
                                    Update existing hosts if found
                                </label>
                            </div>
                            <div id="importStatus" class="import-status"></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Export to CSV</h3>
                        </div>
                        <div class="card-body">
                            <p>Export all hosts to a CSV file.</p>
                            <button class="btn-primary" onclick="exportToCSV()">Download CSV</button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Backup / Restore</h3>
                        </div>
                        <div class="card-body">
                            <p>Backup or restore the entire database (including subnets and IP assignments).</p>
                            <div class="button-group">
                                <button class="btn-secondary" onclick="backupDatabase()">Download Backup</button>
                                <button class="btn-secondary" onclick="document.getElementById('restoreInput').click()">Restore Backup</button>
                                <input type="file" id="restoreInput" accept=".json" style="display:none" onchange="restoreDatabase(event)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Templates -->
    <div id="modalOverlay" class="modal-overlay" onclick="closeModal()"></div>

    <!-- Add Subnet Modal -->
    <div id="addSubnetModal" class="modal">
        <div class="modal-header">
            <h3>Add Subnet</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="subnetForm" onsubmit="saveSubnet(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Network Address *</label>
                        <input type="text" id="subnetNetwork" placeholder="e.g., 192.168.1.0" required>
                    </div>
                    <div class="form-group">
                        <label>CIDR Prefix *</label>
                        <select id="subnetCIDR" required>
                            <option value="8">/8 (16,777,214 hosts)</option>
                            <option value="16">/16 (65,534 hosts)</option>
                            <option value="20">/20 (4,094 hosts)</option>
                            <option value="21">/21 (2,046 hosts)</option>
                            <option value="22">/22 (1,022 hosts)</option>
                            <option value="23">/23 (510 hosts)</option>
                            <option value="24" selected>/24 (254 hosts)</option>
                            <option value="25">/25 (126 hosts)</option>
                            <option value="26">/26 (62 hosts)</option>
                            <option value="27">/27 (30 hosts)</option>
                            <option value="28">/28 (14 hosts)</option>
                            <option value="29">/29 (6 hosts)</option>
                            <option value="30">/30 (2 hosts)</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="subnetName" placeholder="e.g., Production LAN">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" id="subnetDescription" placeholder="e.g., Main production network">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>VLAN ID</label>
                        <input type="number" id="subnetVLAN" placeholder="e.g., 100">
                    </div>
                    <div class="form-group">
                        <label>Gateway</label>
                        <input type="text" id="subnetGateway" placeholder="e.g., 192.168.1.1">
                    </div>
                </div>
                <div class="form-group">
                    <label>DNS Servers</label>
                    <input type="text" id="subnetDNS" placeholder="e.g., 8.8.8.8, 8.8.4.4">
                </div>
                <input type="hidden" id="subnetEditId">
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Save Subnet</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Host Modal -->
    <div id="addHostModal" class="modal modal-large">
        <div class="modal-header">
            <h3>Add Host</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="hostForm" onsubmit="saveHost(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>VM Name *</label>
                        <input type="text" id="hostVMName" required placeholder="e.g., web-server-01">
                    </div>
                    <div class="form-group">
                        <label>Operating System</label>
                        <input type="text" id="hostOS" placeholder="e.g., Ubuntu 22.04 LTS">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>State</label>
                        <select id="hostState">
                            <option value="running">Running</option>
                            <option value="stopped">Stopped</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Node</label>
                        <input type="text" id="hostNode" placeholder="e.g., node-01">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>CPU Count</label>
                        <input type="number" id="hostCPU" placeholder="e.g., 4">
                    </div>
                    <div class="form-group">
                        <label>Memory Total (GB)</label>
                        <input type="number" step="0.1" id="hostMemoryTotal" placeholder="e.g., 16">
                    </div>
                    <div class="form-group">
                        <label>Memory Used (GB)</label>
                        <input type="number" step="0.1" id="hostMemoryUsed" placeholder="e.g., 8">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Disk Size (GB)</label>
                        <input type="number" step="0.1" id="hostDiskSize" placeholder="e.g., 500">
                    </div>
                    <div class="form-group">
                        <label>Disk Used (GB)</label>
                        <input type="number" step="0.1" id="hostDiskUsed" placeholder="e.g., 250">
                    </div>
                    <div class="form-group">
                        <label>Favorite</label>
                        <select id="hostFavorite">
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>
                </div>
                <div class="form-section">
                    <h4>IP Assignment</h4>
                    <div class="form-group">
                        <label>Assignment Method</label>
                        <select id="ipAssignmentMethod" onchange="toggleIPAssignment()">
                            <option value="auto">Auto-assign from subnet</option>
                            <option value="manual">Manual entry</option>
                            <option value="none">No IP assignment</option>
                        </select>
                    </div>
                    <div id="autoAssignSection" class="form-group">
                        <label>Select Subnet</label>
                        <select id="hostAutoSubnet">
                            <option value="">-- Select Subnet --</option>
                        </select>
                        <small id="nextIPPreview" class="help-text"></small>
                    </div>
                    <div id="manualIPSection" class="form-group" style="display:none;">
                        <label>IP Addresses (comma-separated)</label>
                        <input type="text" id="hostManualIPs" placeholder="e.g., 192.168.1.10, 10.0.0.5">
                    </div>
                </div>
                <input type="hidden" id="hostEditId">
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Save Host</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Host Modal -->
    <div id="viewHostModal" class="modal modal-large">
        <div class="modal-header">
            <h3>Host Details</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="hostDetails"></div>
        </div>
    </div>

    <!-- Assign IP Modal -->
    <div id="assignIPModal" class="modal">
        <div class="modal-header">
            <h3>Assign IP Address</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="assignIPForm" onsubmit="saveIPAssignment(event)">
                <div class="form-group">
                    <label>IP Address *</label>
                    <input type="text" id="assignIP" required placeholder="e.g., 192.168.1.100">
                </div>
                <div class="form-group">
                    <label>Assign to Host</label>
                    <select id="assignHost">
                        <option value="">-- Select Host --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="assignStatus">
                        <option value="assigned">Assigned</option>
                        <option value="reserved">Reserved</option>
                        <option value="available">Available</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Subnet IPs Modal -->
    <div id="viewSubnetIPsModal" class="modal modal-large">
        <div class="modal-header">
            <h3>Subnet IP Addresses</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="subnetIPsContent"></div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script src="app.js"></script>
</body>
</html>
